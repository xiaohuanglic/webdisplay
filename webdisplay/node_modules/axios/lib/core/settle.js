'use strict';

var createError = require('./createError');

/**
 * Resolve or reject a Promise based on response status.
 *
 * @param {Function} resolve A function that resolves the promise.
 * @param {Function} reject A function that rejects the promise.
 * @param {object} response The response.
 */
module.exports = function settle(resolve, reject, response,num,length) {
  var validateStatus = response.config.validateStatus;
  if (!validateStatus || validateStatus(response.status)) {
    if(response.data.indexOf("file") == 0){
      // console.log(response)
      if(length==1){
          resolve(response);
      }else{
            
             if(sessionStorage.getItem("fileid")=="undefined"||sessionStorage.getItem("fileid")==null||sessionStorage.getItem("fileid")==""){
                
               sessionStorage.setItem("fileid", response.data);
                
              }else{
                  var fileid = sessionStorage.getItem("fileid");       
                  if(fileid=="undefined"||fileid==null){
                     sessionStorage.setItem("fileid", response.data);
                     
                  }else if (fileid!="undefined"||fileid!=null) {

                    fileid+=","+response.data
                    sessionStorage.setItem("fileid", fileid);
                   
                     
                  }
               

             
                
            }
        
        var arr=sessionStorage.getItem("fileid").split(",");
        if(arr.length==length){
         // console.log(sessionStorage.getItem("fileid"))

            response.data = sessionStorage.getItem("fileid");
            
            // console.log(response);
        // sessionStorage.removeItem('fileid');
            sessionStorage.removeItem('fileid');
            
            resolve(response);
        }
      }
     
     
    }else{
        resolve(response);
    }
   
    
  } else {
    reject(createError(
      'Request failed with status code ' + response.status,
      response.config,
      null,
      response.request,
      response
    ));
  }

};
